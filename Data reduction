from sklearn.decomposition import PCA
import pandas as pd
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt

# Read dataset
df = pd.read_csv('csvfiles/iris.csv')
print(df.head())

# Extract labels and feature variables
labels = df['Species']
x = df.drop(['Id', 'Species'], axis=1)
print(x)

# Optional: quick scatter plot
plt.scatter(x['SepalWidthCm'], x['PetalLengthCm'])
plt.show()

# Standardize features
variables = ['SepalLengthCm','SepalWidthCm','PetalLengthCm','PetalWidthCm']
x = df.loc[:, variables].values
y = df.loc[:, 'Species'].values
x = StandardScaler().fit_transform(x)
x = pd.DataFrame(x)
print(x.head())

# Fit PCA and transform data
pca = PCA()
xpca = pca.fit_transform(x)
xpca = pd.DataFrame(xpca)
print(xpca.head())
# Explained variance
explained_variance = pca.explained_variance_ratio_
print(explained_variance)

# Add labels for PCA plot
xpca['Species'] = y
xpca.columns = ['PC1', 'PC2', 'PC3', 'PC4', 'Species']
print(xpca.head())

# PCA plot (first two components)
fig = plt.figure()
ax = fig.add_subplot(1,1,1)
ax.set_xlabel('Principal Component 1')
ax.set_ylabel('Principal Component 2')
ax.set_title('2 component PCA')
targets = ['Iris-setosa', 'Iris-versicolor', 'Iris-virginica']
colors = ['r', 'g', 'b']
for target, color in zip(targets, colors):
    indicesToKeep = xpca['Species'] == target
    ax.scatter(xpca.loc[indicesToKeep, 'PC1'], xpca.loc[indicesToKeep, 'PC2'], c=color, s=50)
ax.legend(targets)
ax.grid()
plt.show()
